let User,config,jwt;_24d‍.x([["default",()=>_24d‍.o]]);_24d‍.w("../../models/models",[["User",["User"],function(v){User=v}]]);_24d‍.w("../../config/index",[["default",["config"],function(v){config=v}]]);_24d‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);



async function action(req, res) {
  const { io } = req.app
  const { email, password, username } = req.body
  // check if there is a user with the same email
  _24d‍.g.console.log(req.body)

  const exists = await User.findOne({ email: email.toLowerCase() })
      if(exists) return res.status(400).send('Email already exists.')


  const newUser = new User({
    username,
    email,
  })

  // create and save hashed password
  newUser.password = newUser.generateHash(password)

  const user = await newUser.save(),
    tokenData = { id: user.id },
    // create a token
    token = jwt.sign(tokenData, config.JWT_SECRET, { expiresIn: '14d' })

  // send the token and user object as response
  res.send({ user, token })
}

const signup = {
  method: 'post',
  action
}

_24d‍.d(signup);
