let User,config,jwt;_aea‍.x([["default",()=>_aea‍.o]]);_aea‍.w("../../models/models",[["User",["User"],function(v){User=v}]]);_aea‍.w("../../config/index",[["default",["config"],function(v){config=v}]]);_aea‍.w("jsonwebtoken",[["default",["jwt"],function(v){jwt=v}]]);



async function action(req, res) {
  const { email, password } = req.body
  _aea‍.g.console.log(email)
  // check if the user exists
  const user = await User.findOne({ email: email.toLowerCase() })
  if(!user) return res.status(400).send('User not found')

  // check if the password is correct
  // validPassword function comes from the model file
  const valid = user.validPassword(password)
  if(!valid) return res.status(400).send('Incorrect password')

  const tokenData = { id: user.id },
    // create a token
    token = jwt.sign(tokenData, config.JWT_SECRET, { expiresIn: '14d' })

  // send the token and user object as response
  console.log('Login succesful')
  res.send({ user, token })
}

const login = {
  method: 'post',
  action
}

_aea‍.d(login);
